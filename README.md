# VeriForge: Decentralized AI Provenance & Authenticity

**VeriForge** is a decentralized platform designed to restore trust in digital media. By combining **Trusted Execution Environments (TEEs)** with immutable **blockchain provenance** and **decentralized storage**, VeriForge allows creators to generate, certify, and prove the authenticity of AI-generated content.

### ğŸš§ The Problem

As AI tools like Flux and Midjourney become ubiquitous, the line between reality and fabrication blurs. Deepfakes are rampant, and creators struggle to prove ownership or the origin of their digital art.

### ğŸ›¡ï¸ The Solution

VeriForge creates a "Trust Oracle" using **Nautilus** enclaves.

1.  **Generate:** Users generate or edit images inside a secure TEE.
2.  **Prove:** The TEE cryptographically signs the image hash, prompt, and seed _before_ it leaves the secure environment.
3.  **Store:** The raw asset is stored permanently on **Walrus**.
4.  **Certify:** A **Sui NFT** is minted, linking the on-chain certificate to the off-chain storage, creating an unbreakable chain of custody.

---

## ğŸ—ï¸ Architecture & Sponsor Tech Integration

VeriForge leverages the full Mysten Labs stack to ensure security, scalability, and decentralized storage.

### 1\. Nautilus (TEEs) - _The Trust Layer_

We use **Nautilus** to run a secure Rust backend inside an enclave (AWS Nitro compatible).

- **Role:** Acts as the "signer of truth." It communicates with the AI Model provider (fal.ai) and Walrus.
- **Security:** The enclave generates a keypair internally. Because the code is attested, we know for a fact that the signature on the blockchain came from _this_ specific code execution, guaranteeing the prompt and image hash match what was actually generated.
- **Implementation:** `nautilus-server/src/apps/veriforge/mod.rs` handles the generation, hashing, uploading, and Ed25519 signing.

### 2\. Walrus - _The Storage Layer_

We use **Walrus** for decentralized, blob-based storage of the generated media.

- **Role:** Stores the heavy image binary data.
- **Integration:** The Enclave uploads directly to the Walrus Publisher (`publisher-testnet.walrus.space`) and embeds the permanent Aggregator URL into the signed payload. This ensures the image data is immutable and available independently of any centralized web server.

### 3\. Sui - _The Verification Layer_

We use **Sui Move** for the ownership registry and public verification.

- **Smart Contract:** `veriforge::certifier` manages the **Registry** and **ImageCertificate** NFTs.
- **Registry:** A shared `Table` object mapping `Image Hash -> NFT ID`. This enables our **"Reverse Image Search"** feature, allowing anyone to upload a raw image file and instantly find its on-chain provenance.
- **Verification:** The contract verifies the Enclave's Ed25519 signature before minting, ensuring only authorized, TEE-generated content can be certified.

---

## âœ¨ Key Features

- **ğŸ¨ Text-to-Image Generation:** Create high-quality AI art using the Flux.1 [dev] model.
- **ğŸª„ Image-to-Image Editing:** Upload a source image to Walrus and transform it using AI prompts (e.g., "Turn this sketch into a cyberpunk city").
- **âœ… Cryptographic Certification:** Every image is minted as a Sui NFT containing the `prompt_hash`, `image_hash`, `model_seed`, and `walrus_blob_id`.
- **ğŸ” Reverse Image Verification:** Upload _any_ image file from your computer. The dApp hashes it locally and queries the on-chain Registry to verify if it was generated by VeriForge and retrieve its original metadata.
- **ğŸ“¦ Permanent Storage:** All assets are pinned on the Walrus Testnet.

---

## ğŸš€ Getting Started (Local Development)

### Prerequisites

- **Rust & Cargo** (latest stable)
- **Sui CLI** (installed and configured for Testnet)
- **Node.js & Yarn/NPM**
- **Fal.ai API Key** (for AI generation)

### 1\. Clone the Repository

```bash
git clone https://github.com/your-username/veriforge.git
cd veriforge
```

### 2\. Run the Nautilus Enclave (Backend)

This simulates the TEE locally.

```bash
cd nautilus/src/nautilus-server

# Set your AI provider key
export FAL_KEY="your_fal_ai_key_here"

# Run the server (uses a fixed seed for stable local dev keys)
cargo run --release --features veriforge -- --port 3000
```

_The server will start at `http://localhost:3000`._

### 3\. Deploy Smart Contracts

In a new terminal:

```bash
cd contracts/veriforge

# Publish to Sui Testnet
sui client publish --gas-budget 100000000 --with-unpublished-dependencies
```

_Note the **Package ID** from the output._

### 4\. Initialize On-Chain Objects

You need to run three commands to set up the system (replace placeholders with actual IDs from the previous step's output).

```bash
# 1. Create the Image Registry
sui client call --package <PACKAGE_ID> --module certifier --function setup_registry --gas-budget 100000000

# 2. Create the Enclave Config
sui client call --package <PACKAGE_ID> --module certifier --function setup_enclave --gas-budget 100000000

# 3. Register your Local Enclave Key
# Get your server key: curl http://localhost:3000/health_check
# Replace <ENCLAVE_CONFIG_ID> from step 2 and <PK_HEX> from curl
sui client call --package <PACKAGE_ID> --module enclave --function register_debug_enclave --type-args "<PACKAGE_ID>::certifier::VeriforgeApp" --args <ENCLAVE_CONFIG_ID> 0x<PK_HEX> --gas-budget 100000000
```

### 5\. Configure & Run Frontend

1.  Open `frontend/src/constants.ts`.
2.  Paste your **Package ID**, **Registry ID**, and **Enclave Object ID** (from Step 4.3).
3.  Run the dApp:

<!-- end list -->

```bash
cd frontend
npm install
npm run dev
```

Visit `http://localhost:5173` and start creating\!

---

## ğŸ§ª Testing the Flow

1.  **Generate:** Go to "Create & Mint", type "A futuristic gold coin", and click Generate.
2.  **Explorer:** Click the "View on SuiScan" link to see your new NFT.
3.  **Reverse Lookup:**
    - Right-click the image in the UI -\> "Open in new tab" -\> Save it.
    - Go to the **"Reverse Image Verification"** tab.
    - Upload that file.
    - VeriForge will hash it, query the contract, and verify it is an authentic asset\!

---

## ğŸ“œ License

Apache-2.0

---

_Built with â¤ï¸ for the Walrus Haulout Hackathon 2025._
